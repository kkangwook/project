--ì§ˆì˜ì‘ë‹µ
# ì°¨íŠ¸ì¸ ì—¬ë¶€ê°€ ì¤‘ìš”í•œ ì´ìœ ëŠ”?  ì°¨íŠ¸ì¸ í•œë²ˆí•˜ë©´ ì¸ì§€ë„ìƒìŠ¹+ì¶”ì²œë¦¬ìŠ¤íŠ¸ì—ì˜¤ë¦„, ìŠ¤íŠ¸ë¦¬ë°ìˆ˜ê°€ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•´ ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ìµë„ ì¦ê°€, 
    # ë‹¤ì–‘í•œ ë°©ì†¡ì‚¬ì™€ ë¯¸ë””ì–´ëŠ” ìŠ¤íŠ¸ë¦¬ë° ì‚¬ì´íŠ¸ ìˆœìœ„ë¥¼ ê³¡ì˜ ì¸ê¸°ì²™ë„ë¡œ ì°¸ê³ í•˜ë©° ë°©ì†¡ì¶œì—°ì´ë‚˜ í–‰ì‚¬ìˆ˜ë„ ê°™ì´ ì¦ê°€í•´ì„œ ê°€ìˆ˜ì™€ ì†Œì†ì‚¬ì— í° ì´ë“  
# ì°¨íŠ¸ì¸-ì°¨íŠ¸ì•„ì›ƒì€ 1ë…„ì¹˜ top100ì„ ê¸°ì¤€ìœ¼ë¡œ 3ë…„ì¹˜ í•œê±° ëª…ì‹œí•˜ê¸°+ ì°¨íŠ¸ì•„ì›ƒì€ ìˆ˜ë™ìœ¼ë¡œ ë…¸ë˜ ë¦¬ìŠ¤íŠ¸ ì°¾ìŒ -> ì•ì˜ íŒ¨í„´ë¶„ì„ë„ ë…„ ë‹¨ìœ„ì—¬ì„œ ì¼ê´€ì„± ìœ„í•´ ë…„ë‹¨ìœ„ë¡œí•¨+ ê°œì›”ê³¼ ê°™ì€ ê²½ìš°ë¡œ í• ê²½ìš°
                                                            12ê°œì›”ì¹˜ë¥¼ ë½‘ëŠ”ë‹¤ë©´ 1200ê° ë° í•˜ë‚˜ì”© ìˆ˜ë™ìœ¼ë¡œ ì°¾ê¸°ëŠ” ë„ˆë¬´ ë§ì€ ì‹œê°„ì´ í•„ìš”
# ì¹´ë©œë¡¯ì´ í‚¤ì™€ ëŒ€ì‘ëœë‹¤ëŠ”ê²ƒì„ ì„¤ëª…(ë‘˜ë‹¤ 24ê°€ì§€ ì¢…ë¥˜ê°€ 1ëŒ€1 ëŒ€ì‘)
# ì¥ë¥´ label encodingë„ í•´ë´¤ì§€ë§Œ one-hot-encodingì´ ë” ê²°ê³¼ ì¢‹ì•˜ìŒ
# ë³€ìˆ˜ì„¤ì •í•œ ì´ìœ ì„¤ëª…í•˜ê¸°
    - í‚¤ê°™ì€ ê²½ìš° ì¹´ë©œë¡¯ê³¼ ì¤‘ë³µë˜ì–´ì„œ ëºŒ, ì‚¬ì „ì¡°ì‚¬ê²°ê³¼ ìŒì›ê¸¸ì´ëŠ” ì°¨íŠ¸ì¸ì— ë³„ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šì•„ ë»„, happinessì™€ ê°™ì€ ê°ì •ê³¼ ê´€ë ¨ëœ ì£¼ê´€ì ì¸ íŠ¹ì„±ë“¤ë„ ì œê±°
    - ìŒì•… ë°ì´í„°ì™€ ìƒê´€ì—†ëŠ” liveness(ì²­ì¤‘ì—¬ë¶€)ê°™ì€ê±° ì œê±° í•˜ì—¬ í˜„ì¬ì˜ ê²ƒë§Œ ì‚¬ìš©-> ë‚˜ì¤‘ì— ê²°ê³¼ë¥¼ ë³´ë©´ ì•Œê² ì§€ë§Œ xgbì˜ feature_importanceì—ì„œ bpm,energy,dan,acëª¨ë‘ ìƒìœ„ê¶Œì— ìœ„ì¹˜í•´ ê·¸ëŒ€ë¡œ ìœ ì§€
# ì›í•«ì¸ì½”ë”© í•œ ì• ë“¤ì€ ìƒëŒ€ì ìœ¼ë¡œ feature importanceê°€ ë‚®ê²Œ ë‚˜ì˜¬ìˆ˜ë°–ì— ì—†ìŒ/ ì¹´ë©œë¡¯ì˜ sin-così¸ì½”ë”©ì€ 3ì°¨ì›ìœ¼ë¡œ ì¤„ì˜€ê¸°ì— ìƒëŒ€ì ìœ¼ë¡œ ì¤‘ìš”ë„í¼
    - feature_importanceê°€ í¬ë‹¤-> ì†ì‹¤ê°ì†Œì— í° ê¸°ì—¬ë¥¼ í–ˆë‹¤-> 
  ë”°ë¼ì„œ aë¼ëŠ” íŠ¹ì„±ì´ ë„ˆë¬´ ì¤‘ìš”í•´ì„œ ì´ˆë°˜ì— í¬ê²Œ ê·¸ íŠ¹ì„±ìœ¼ë¡œ ë‚˜ëˆ„ê³  ë‚˜ë¨¸ì§€ë¥¼ ì„¸ì„¸í•˜ê²Œ ë‚˜ëˆŒë–„ ë‹¤ë¥¸ íŠ¹ì„±ë“¤ì„ ë§ì´ì¨ì„œ aì˜ feature importanceê°’ì´ ì‘ê²Œ ë‚˜ì˜¬ìˆ˜ë„ìˆì–´? -> ì—†ë‹¤
# shapë„ í‘œì‹œ -> í•˜ë‚˜ì˜ ë³€ìˆ˜ì— ëŒ€í•´ ê·¸ ê°’ì´ ì´ì§„ë¶„ë¥˜ì— ìˆì–´ì„œ ìŒì˜ ì˜í–¥(í´ë˜ìŠ¤0ìœ¼ë¡œ)ì„ ì¤„ì§€ ì–‘ì˜ ì˜í–¥(í´ë˜ìŠ¤1ë¡œì˜ˆì¸ ë˜ê²Œë”)ì„ ì¤„ì§€ ë³´ì—¬ì£¼ëŠ” ì§€í‘œ
    



#ligthgbmì´ë‚˜ histgradientboostingì¨ë³´ê¸°
#ì‹œê°í™” ìƒê´€ê´€ê³„ë„ ë³´ê¸°
# ë¡ë©”íƒˆì»¬ëŸ¼*10í•˜ê±°ë‚˜, í´ë˜ìŠ¤ë³„ë¡œ ê°€ì¤‘ì¹˜ë¥¼ ë‹¬ë¦¬ì£¼ê±°ë‚˜, ìƒ˜í”Œë³„ ë¡ë©”íƒˆí¬í•¨í•œì• ë“¤ ê°€ì¤‘ì¹˜ ë” ë†’ê²Œì£¼ê±°ë‚˜ 
#xgboostparameter
xgb = XGBClassifier(use_label_encoder=False, eval_metric='logloss')


#ì•™ìƒë¸”ì—ì„œëŠ” ë ˆì´ë¸”ì¸ì½”ë”©ë„ë°©ë²•,ëª¨ë“ ë³€ìˆ˜ë„£ê³  feature_importanceë¡œ ì¤‘ìš”ë„ë´ì„œ ì–´ë–¤ë³€ìˆ˜ëº„ì§€ê²°ì •
# class1ê³¼ class0ì˜ ìƒ˜í”Œìˆ˜ ê±°ì˜ 1ëŒ€1ë¡œ ìƒ˜í”Œë¶ˆê· í˜•ì˜ ë¬¸ì œëŠ” ì—†ë‹¤
# permutation importanceë¡œ ì…ë ¥ë³€ìˆ˜ ì¤‘ í•˜ë‚˜ì˜ ì˜í–¥ì„ ì œê±°í•˜ì—¬ ì„±ëŠ¥ì˜ ì°¨ì´ê°€ ì–¼ë§ˆë‚˜ ë‚˜ëŠ”ì§€ í™•ì¸
# ë‹¨ìˆœ ê°€ìˆ˜ì™€ ìŒì•…ì˜ ì •ë³´ë§Œìœ¼ë¡œ ì˜ˆì¸¡ê°€ëŠ¥í• ê¹Œ?
# ë‚ ì”¨ë³„ ë°°ë‹¬ìŒì‹ ì¶”ì²œëª¨ë¸ì—ì„œ svm vs randomforestíŠ¹ì§• ê°€ì ¸ì˜¤ê¸°
#ì°¨íŠ¸ì¸ì˜ˆì¸¡ëª¨ë¸==ì¸ê¸°ì˜ˆì¸¡ëª¨ë¸
# íŠ ë±ƒì“´ì´ìœ -> ìŠ¤í¬í‹°íŒŒì´apiì§€ì›ì¤‘ë‹¨
# chart_out ë½/ë©”íƒˆë¹¼ë³´ê¸°
# ë§ˆì§€ë§‰ì— ì–´ë–¤ íŠ¹ì§•ì¼ìˆ˜ë¡ ì°¨íŠ¸ì¸í• ìˆ˜ìˆëŠ”ì§€ ì¡°ê±´ì“°ê¸°


#ë°ì´í„°ì „ì²˜ë¦¬:
1. ê²°ì¸¡ì¹˜ í™•ì¸í›„ ì œê±°
2. ì´ìƒì¹˜í™•ì¸ (min, max)
3. likeëŠ” ì½¤ë§ˆì œê±°í›„ ìˆ«ìí™”
4. ì¥ë¥´ëŠ” ì—¬ëŸ¬ ì¥ë¥´ì¼ê²½ìš° ì•ì˜ ëŒ€í‘œ ì¥ë¥´ë§Œ ê°€ì ¸ì˜´
5. 
4.ì¹´ë©œë¡¯ì˜ ì›í•«ì¸ì½”ë”© vs cos-sinì¸ì½”ë”© + svc vs xgboostclassifier -> aucì ìˆ˜ë¡œ í™•ì¸
5. xgboostì™€ cos-sinì¸ì½”ë”© ì„ íƒ í›„ lightGBM, histgradient boostingê³¼ ë„ ë¹„êµ-> xgboost
6. xgboostì˜ feature importanceë´ì„œ ì¤‘ìš” ë³€ìˆ˜ ì„ íƒ
7. ì•™ìƒë¸”ì—ì„œëŠ” ë ˆì´ë¸”ì¸ì½”ë”©ë„ë°©ë²•,ëª¨ë“ ë³€ìˆ˜ë„£ê³  feature_importanceë¡œ ì¤‘ìš”ë„ë´ì„œ ì–´ë–¤ë³€ìˆ˜ëº„ì§€ê²°ì • -> ë ˆì´ë¸” ì¸ì½”ë”©ë³´ë‹¤ ì›í•«ì¸ì½”ë”©ì´ ë‚˜ìŒ

# .scoreëŠ” ì–¼ë§ˆë‚˜ ì˜ ë§ì¶”ëŠ”ì§€, .aucëŠ” ì˜ˆì¸¡í™•ë¥ ì´ ì–¼ë§ˆë‚˜ ì •í™•í•œì§€(0.51, 0.49ì´ëŸ°ê±´ ë³„ë¡œ-> ëœ ë§ì¶”ë”ë¼ë„ 0.8, 0.2ì´ëŸ°ì‹ìœ¼ë¡œ ë‚˜ì˜¤ê²Œë”)

# Define parameter grid to sample from
param_dist = {
    'n_estimators': [50, 100, 200, 300, 500],
    'max_depth': [3, 4, 5, 6, 7, 8],
    'learning_rate': np.linspace(0.01, 0.3, 30),
    'subsample': np.linspace(0.5, 1.0, 6),
    'colsample_bytree': np.linspace(0.5, 1.0, 6),
    'gamma': [0, 0.1, 0.2, 0.3, 0.4],
    'reg_alpha': [0, 0.01, 0.1, 1, 10],  # L1 regularization
    'reg_lambda': [1, 1.5, 2, 3, 5]      # L2 regularization
}

# Setup RandomizedSearchCV
random_search = RandomizedSearchCV(
    estimator=xgb,
    param_distributions=param_dist,
    n_iter=50,  # number of random parameter sets to try
    scoring='roc_auc',
    cv=5,
    verbose=1,
    random_state=42,
    n_jobs=-1
)




# í•œêµ­ ìŒì› audio_featureì‚¬ì´íŠ¸: TuneBat
 ë°ì´í„° ì¶œì²˜
Spotify Web API í™œìš©
ì‚¬ì´íŠ¸ëŠ” 70â€¯M+ ê³¡ì˜ í‚¤, BPM ë“±ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ Spotifyì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
Tunebat ìì²´ ë¶„ì„ ì™¸ì— ì´ Spotify ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •ë³´ë„ í¬í•¨ 

Essentia.js ê¸°ë°˜ ë¸Œë¼ìš°ì € ë¶„ì„
íŒŒì¼ ì—…ë¡œë“œ ì‹œ ë¸Œë¼ìš°ì € ë‚´ì—ì„œ Essentia.js(ìŠ¤í˜ì¸ ë°”ë¥´ì…€ë¡œë‚˜ UPFì˜ Music Technology Group(MTG) ê°œë°œ)ë¥¼ ì‚¬ìš©í•´ ë¶„ì„í•©ë‹ˆë‹¤ 
Energy, danceability, happiness ë“± ML ê¸°ë°˜ ì¶”ì • ì§€í‘œëŠ” í•™ìŠµëœ ë¶„ì„ ëª¨ë¸ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤ 

âœ… ì‹ ë¢°ì„± í‰ê°€
í‚¤(BPM, Camelot key)
Spotify APIì—ì„œ ê°€ì ¸ì˜¤ë©°, Tunebat ë‚´ ë¶„ì„ê³¼ ë¹„êµí•´ ì œê³µë¨.
Spotify ë©”íƒ€ë°ì´í„°ëŠ” ì •í™•ë„ê°€ ê·¸ë¦¬ ë†’ì§€ ì•Šë‹¤ëŠ” ì§€ì ë„ ì¡´ì¬(<â€¯33% ì •í™•ë„) 
ë°˜ë©´ Tunebatì˜ ë¸Œë¼ìš°ì € ë¶„ì„ë„ â€œë‹¤ë¥¸ ìƒìš© í‚¤/BPM ë¶„ì„ë³´ë‹¤ ë” ë‚˜ì€ ê²½ìš°ë„ ìˆë‹¤â€ê³  ê³µì‹ ì–¸ê¸‰ 

Sentiment (energy/danceability/happiness)
ëª¨ë‘ ML ëª¨ë¸ë¡œ ì¶”ì •ëœ ê°’ì´ë©°, ì ˆëŒ€ì  ì§„ì‹¤ì´ë¼ê¸°ë³´ë‹¤ëŠ” â€˜ê³¡ íŠ¹ì„±ì˜ ìƒëŒ€ì  ë¶„ì„ ê²°ê³¼â€™ë¡œ ì´í•´í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤ 

ì»¤ë®¤ë‹ˆí‹°Â·ì „ë¬¸ê°€ ì˜ê²¬
Reddit / MP3Tag ë“±ì—ì„œ Tunebatì€ "ìœ ìš©í•˜ë‹¤"ì§€ë§Œ, ì •í™•ë„ ìµœìƒê¸‰ì´ë¼ê¸°ë³´ë‹¤ ì°¸ê³ ìš©ìœ¼ë¡œ ì‚¬ìš©ë¨ 

ğŸ§­ ì •ë¦¬
ì¶œì²˜: Spotify API + Essentia.js + ìì²´ ML ëª¨ë¸ ê¸°ë°˜ ë¶„ì„.
BPM/í‚¤: ë¹„êµì  ë¯¿ì„ ë§Œí•˜ì§€ë§Œ, Spotify ê¸°ë³¸ ë©”íƒ€ëŠ” ë¶€ì •í™•í•  ìˆ˜ ìˆìŒ (íŠ¹íˆ í‚¤ ì •ë³´).
í‘œì •ê°’ (energy ë“±): ì§€í‘œì  ì°¸ê³ ìš©ì´ë©°, ì ˆëŒ€ê°’ì´ ì•„ë‹˜.
ê²°ë¡ : â€œì •í™•í•œ ì‚¬ì´íŠ¸â€ë¼ê¸°ë³´ë‹¤ëŠ” ë¯¿ì„ ë§Œí•œ ì°¸ê³  ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.





# ëª¨ë¸ ì •í™•ë„ ë†’íˆê¸°
-svmë„ ì‚¬ìš©í•´ë³´ê¸°
-cos-sin encodingë§ê³  oheë„ í•´ë³´ê¸°
-3ë…„ë‹¨ìœ„ë¡œ í•´ë³´ê¸°
-ì¥ë¥´ ìˆ«ìì„¸ì„œ ì¼ì •ê°œìˆ˜ ë¯¸ë§Œì¸ ì• ë“¤ì€ ì „ë¶€ ê¸°íƒ€ë¡œ ì¹˜í™˜í•˜ê³  ëª¨ë¸ë§Œì„ì–´ë³´ê¸°
-ê°€ì¤‘ì¹˜ ë‹¬ë¦¬í•´ì„œ í•´ë³´ê¸°
-3.5:6.5ì˜ í´ë˜ìŠ¤ê°œìˆ˜ ë¶ˆê· í˜•ìˆìŒ
scale_pos_weight = n_negative / n_positive = 850 / 450 â‰ˆ 1.89
XGBClassifier(..., scale_pos_weight=1.89)-> ì°¨íŠ¸ì¸ ì˜ˆì¸¡ì„ ë” ë¯¼ê°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ


# ì¹´ë©œë¡¯, í‚¤ ì¤‘ ì¹´ë©œë¡¯ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì„ë“¯(ì¢€ë” ì‚¬ëŒì´ ë“£ëŠ” ë¶„ìœ„ê¸°ë‘ ë” ë¹„ìŠ·)
 # ì¹´ë©œë¡¯ ì¸ì½”ë”©ë°©ë²•: Embedding ë˜ëŠ” Sine/Cosine ì¸ì½”ë”© (ê¶Œì¥)
ì›í˜• ë°ì´í„°ë¥¼ ìˆ«ìë¡œ ì¸ì½”ë”©í•  ë•ŒëŠ” sin/cos ë³€í™˜ì´ ìµœì 
-> ì‹œê°„, ìš”ì¼, ë°©í–¥ë“±ì˜ ìˆœí™˜ ë°ì´í„°ì— ì‚¬ìš©
-> ì›í˜•ë°ì´í„°ë¥¼ ê°ë„ë¡œ ë°”ê¾¸ê³  ê·¸ ì‚¬ì¸/ì½”ì‚¬ì¸ ê°’ì„ 2ì°¨ì› ë²¡í„°ë¡œ ì¶”ê°€í•˜ëŠ”ê²ƒ
angle = 2Ï€ Ã— (ê°’ - 1) / 12
np.sin(angle)
np.cos(angle)
ì¶”í›„ feature_importanceì—ì„œ importance_camelot = importance_sin + importance_cos ì²˜ëŸ¼ í•©ì‚°í•˜ê¸°ë„ í•¨ 



--ê²€ì¦ìœ¼ë¡œ roc_auc_score()ì‚¬ìš©-> ì‹¤ë¬´ì—ì„œ ë” ì„ í˜¸


import numpy as np

camelot_number = 8   # 1~12
angle = 2 * np.pi * (camelot_number - 1) / 12
camelot_sin = np.sin(angle)
camelot_cos = np.cos(angle)

ê²°ê³¼:
camelot_sin â‰ˆ 0.866
camelot_cos â‰ˆ -0.5
â¡ï¸ ìµœì¢… í”¼ì³ ë²¡í„°: [camelot_sin, camelot_cos, camelot_mode] (3ì°¨ì›)

ì¥ì :

1Aì™€ 12Aê°€ ê°€ê¹ë‹¤ëŠ” ê±¸ ìˆ˜í•™ì ìœ¼ë¡œ í‘œí˜„ ê°€ëŠ¥

ì›í˜• êµ¬ì¡°ë¥¼ ìœ ì§€í•œ ì±„ ìˆ«ì ì¸ì½”ë”© ê°€ëŠ¥

ë§ì€ ì‹¤ì œ ëª¨ë¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ (ì‹œê°„, ê°ë„ ë“±ì—ì„œ)



-------------------------------------------------------------------------------------------
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import os
import time
import csv
from selenium.webdriver.chrome.options import Options
from selenium.common.exceptions import ElementClickInterceptedException
from selenium.webdriver.common.action_chains import ActionChains

# ë¡œë´‡ ë¬´ì‹œ ë° ê´‘ê³  ì°¨ë‹¨ ì„¤ì •
options = Options()
options.add_argument('--disable-blink-features=AutomationControlled')
options.add_argument('--disable-notifications')
options.add_argument('--disable-popup-blocking')
options.add_argument('--disable-infobars')
options.add_argument('--disable-gpu')
options.add_argument('--disable-extensions')
options.add_argument('--no-sandbox')
options.add_argument('--disable-dev-shm-usage')

# í¬ë¡¬ driver ìƒì„± 
driver_path = ChromeDriverManager().install()
correct_driver_path = os.path.join(os.path.dirname(driver_path), "chromedriver.exe")
driver = webdriver.Chrome(service=Service(executable_path=correct_driver_path), options=options)
driver.maximize_window()  # ì°½ ìµœëŒ€í™”

########################ì—¬ê¸°ì— ì§ˆë¬¸ ì‚½ì…#################################
year=2024
query = list_2024
########################################################################

f=open(f'./tunebat_{year}.csv','w',encoding='utf-8-sig',newline='')
writer=csv.writer(f)
title_row = ['artist','song','key','camelot','bpm','duration','popularity','energy','danceability','happiness','acousticness','instrumentalness','liveness','speechiness','loudness','year']
writer.writerow(title_row)

def click_element_safely(element, driver):
    """ìš”ì†Œë¥¼ ì•ˆì „í•˜ê²Œ í´ë¦­í•˜ëŠ” í•¨ìˆ˜"""
    try:
        # ì¼ë°˜ì ì¸ í´ë¦­ ì‹œë„
        element.click()
    except ElementClickInterceptedException:
        try:
            # JavaScriptë¡œ í´ë¦­ ì‹œë„
            driver.execute_script("arguments[0].click();", element)
        except:
            try:
                # Action chainsë¡œ í´ë¦­ ì‹œë„
                ActionChains(driver).move_to_element(element).click().perform()
            except:
                return False
    return True

# ëŒ€ìƒ url ì´ë™ 
driver.get('https://tunebat.com/')
time.sleep(7)

for i in query:
    try:
        # ê²€ìƒ‰ì°½ 
        box = WebDriverWait(driver, 10).until(
            EC.presence_of_element_located((By.XPATH, '/html/body/div[2]/section/section/main/div/form/div/span/input'))
        )
        box.clear()  # ì´ì „ ê²€ìƒ‰ ì§€ìš°ê¸°
        box.send_keys(i) # ê²€ìƒ‰ì°½ì— ì¿¼ë¦¬ë„£ê¸°
        box.send_keys(Keys.ENTER) #ì—”í„°
        
        # ê²€ìƒ‰ ê²°ê³¼ì˜ ì²« ë²ˆì§¸ í•­ëª© ëŒ€ê¸° ë° í´ë¦­
        btn = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.XPATH, '/html/body/div[2]/section/section/main/div/div[2]/div[2]/div[1]/a'))
        )
        
        # iframe ì œê±° ì‹œë„
        try:
            iframes = driver.find_elements(By.TAG_NAME, "iframe")
            for iframe in iframes:
                driver.execute_script("arguments[0].remove();", iframe)
        except:
            pass
        
        # ì•ˆì „í•œ í´ë¦­ ì‹œë„
        if not click_element_safely(btn, driver):
            print(f"Failed to click for query: {i}")
            # Write NaN values for failed click
            nan_row = ['NaN'] * (len(title_row) - 1) + [year]
            writer.writerow(nan_row)
            continue
            
        # ë°ì´í„° ìˆ˜ì§‘
        time.sleep(3)  # ë¡œë”© ëŒ€ê¸° ì‹œê°„ ì¦ê°€
        
        data1 = driver.find_elements(By.CLASS_NAME, 'ant-typography')
        lists = []
        k = 0
        prelists = []
        for item in data1:
            prelists.append(item.text)
            k += 1
            if k > 21: break
            print(k,item.text)
            
        if prelists[13].startswith('Label'):
            lists.extend([prelists[0],prelists[1],prelists[2],prelists[4],prelists[6],prelists[8]])
        else:
            lists.extend([prelists[0],prelists[1],prelists[2],prelists[4],prelists[6],prelists[8]])
            
        data2 = driver.find_elements(By.CLASS_NAME, 'ant-progress-text')
        for item in data2:
            lists.append(item.text)
            
        lists.append(year)
        print(lists)
        print(prelists)
        
        # Ensure the list has the correct number of elements
        if len(lists) < len(title_row):
            lists.extend(['NaN'] * (len(title_row) - len(lists)))
        writer.writerow(lists)
        
        # í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        home = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.XPATH, '/html/body/div[2]/section/section/div[1]/div/div[1]/a'))
        )
        click_element_safely(home, driver)
        time.sleep(3)  # í™ˆí˜ì´ì§€ ë¡œë”©ì„ ìœ„í•œ ëŒ€ê¸° ì‹œê°„ ì¦ê°€
        
    except Exception as e:
        print(f"Error processing {i}: {str(e)}")
        # Write NaN values for all columns except year when an error occurs
        nan_row = ['NaN'] * (len(title_row) - 1) + [year]
        writer.writerow(nan_row)
        # ì—ëŸ¬ ë°œìƒì‹œ í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ì‹œë„
        try:
            driver.get('https://tunebat.com/')
            time.sleep(5)
        except:
            pass
        continue

driver.quit()
f.close()
